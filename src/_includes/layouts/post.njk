{% extends 'layouts/default.njk' %}

{% block content %}
  <article class="c-article">
    <header class="c-article__header">
      <div class="c-article__meta">
        {% include "components/post-date.njk" %}
        {% include "components/tags.njk" %}
      </div>

      <h1 class="c-article__title">
        <span>{{ title }}</span>
      </h1>

      {% if link %}
        <p class="u-margin-top-025">
          {% Link link, null, true %}
        </p>
      {% endif %}
      {% if intro %}
        <p class="u-lead">{{ intro }}</p>
      {% endif %}
    </header>
    <section class="c-article__content u-stack--4 u-stack--post">
      {{content | markdownify | safe}}
      {% include "components/share.njk" %}
    </section>

    <footer class="c-article__footer">
      <div class="c-article__author">
        <div class="c-article__author-avatar">
          <img width="100" height="100" src="/assets/images/avatar-200.jpg">
        </div>
        <div class="c-article__author-info">
          <span>Written by</span>
          <h3 class="c-article__author-name">{{site.title}}</h3>
        </div>
      </div>
    </footer>
  </article>
{% endblock %}

{% block scripts %}
  <script src="https://cdn.jsdelivr.net/npm/simplebar@latest/dist/simplebar.min.js"></script>
  <script>
    Array.prototype.forEach.call(
      document.querySelectorAll('pre[class*=language-]'),
      el => new SimpleBar(el, { autoHide: false })
    );

    const articleHeader = document.querySelector(".c-article__header");
    const articleTitle = document.querySelector(".c-article__title");
    const articleTitleText = document.querySelector(".c-article__title span");
    const articleAuthor = document.querySelector(".c-article__footer .c-article__author");

    const range = 100;

    document.addEventListener("scroll", () => {
      const currentScroll = pageYOffset;
      const backgroundMove = Math.round((currentScroll / 3 / (range * 11)) * 100);

      if (articleTitle && articleTitleText && articleAuthor) {
        const CompletelyFadePoint =
          articleTitleText.getBoundingClientRect().top + pageYOffset + 40;
        const opacityValue =
          1 - (currentScroll - CompletelyFadePoint + range) / range;

        articleTitleText.style.opacity = opacityValue;
        articleTitleText.style.transform = `translateY(${currentScroll / 3}px)`;
        articleTitleText.style.transform = `translateY(${currentScroll / 3}px)`;

        if (opacityValue > "1") {
          articleTitleText.style.opacity = 1;
        } else if (opacityValue < "0") {
          articleTitleText.style.opacity = 0;
        }

        articleHeader.style.backgroundPosition = `0 -${backgroundMove}%`;
        articleAuthor.style.backgroundPosition = `0 -${backgroundMove}%`;
      }
    });
  </script>
{% endblock %}
